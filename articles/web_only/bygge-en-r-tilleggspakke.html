<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hvordan å bygge en R-pakke • fellesr</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Hvordan å bygge en R-pakke">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">fellesr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/web_only/bygge-en-r-tilleggspakke.html">Hvordan å bygge en R-pakke</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/kjre-r-p-sl-stata-p3-fra-sas.html">Kjøre R på sl-stata-p3 fra SAS</a></li>
    <li><a class="dropdown-item" href="../../articles/vignette__DAPLA_jukseark.html">DAPLA jukseark</a></li>
    <li><a class="dropdown-item" href="../../articles/vignette_dynarev_uttrekk.html">Uttrekk fra Dynarev til R</a></li>
    <li><a class="dropdown-item" href="../../articles/vignette_shiny_ssb.html">Kjøre shiny og Esquisse i Jupyter</a></li>
    <li><a class="dropdown-item" href="../../articles/vignette_SSB_fargepalett.html">SSB fargepallet fra KLASS</a></li>
    <li><a class="dropdown-item" href="../../articles/vignette_SSB_pakke.html">SSB mal for R-pakker</a></li>
    <li><a class="dropdown-item" href="../../articles/vignette_SSB_theme.html">SSB ggplot theme</a></li>
    <li><a class="dropdown-item" href="../../articles/vignette_statbank_lasting.html">Lasting til statistikkbanken</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hvordan å bygge en R-pakke</h1>
                        <h4 data-toc-skip class="author">Susie
Jentoft</h4>
            
            <h4 data-toc-skip class="date">2022-06-10</h4>
      

      <div class="d-none name"><code>bygge-en-r-tilleggspakke.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="hvorfor-bygge-en-r-pakke">Hvorfor bygge en R-pakke?<a class="anchor" aria-label="anchor" href="#hvorfor-bygge-en-r-pakke"></a>
</h2>
<p>Har du en laget en funksjon som du tror andre kan få nytte av? Den
beste løsning for å dele funksjoner i R med andre er å lage en pakke.
Koden blir dokumentert på en standardisert måte og det kan lett deles
med andre internt og eksternt. Det er gode løsninger for avhengighet
mellom pakker og funksjoner i ulike pakker. Hovedårsakene for å bygge
R-pakker:</p>
<ul>
<li>Lett å dele og flytte</li>
<li>Organisere arbeid</li>
<li>Dokumentasjon for både deg selv og andre</li>
</ul>
<p><a href="https://r-pkgs.org/index.html" class="external-link">R Packages</a> skrevet av
Hadley Wickham er en veldig god referanse for pakke-bygging. Denne
bloggen gir en kort intro og referere til forkjellige uvsnitt i boken
for videre lesing.</p>
</div>
<div class="section level2">
<h2 id="teknisk-oppsett">Teknisk oppsett<a class="anchor" aria-label="anchor" href="#teknisk-oppsett"></a>
</h2>
<p>Det er anbefalt å bygge R-pakke i RStudio. Det er lettest å gjøre
dette i admin/på PC eller på linux. På linux er alle nødvendig
tilleggsverktøy og pakker installerte.</p>
<p>For å bygge en pakke i admin/på PC:</p>
<ul>
<li>Installere <a href="https://www.r-project.org/" class="external-link">R</a> og <a href="https://www.rstudio.com/products/rstudio/" class="external-link">RStudio</a> hvis ikke
du har gjort dette tidligere. Søk om admin tilgang til PCen din om
nødvendig.</li>
<li>Installere <a href="https://git-scm.com/" class="external-link">git</a>. Dette er verktøy
vi bruker for å dele pakken etterpå.</li>
<li>Det er anbefalte å installere <a href="https://cran.r-project.org/bin/windows/Rtools/rtools40.html" class="external-link">Rtools</a>,
særlig hvis koden inkluderer C, C++ eller Fortran kode.</li>
<li>Hvis du vil bygge pdf-hjelp filene selv trenger du å installere en
LaTeX verktøy for eks. <a href="https://miktex.org/download" class="external-link">MikTex</a>
</li>
</ul>
<p>Det er fem nyttige R-pakker som gjøre pakke bygging prosessen
lettere. Disse kan installeres ved:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"roxygen2"</span>, <span class="st">"testthat"</span>, <span class="st">"usethis"</span>, <span class="st">"knitr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Endelig kan du sjekke om systemet er klar for å bygge en pakke ved å
kjøre:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">has_devel</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bygge-pakke-struktur">Bygge pakke-struktur<a class="anchor" aria-label="anchor" href="#bygge-pakke-struktur"></a>
</h2>
<p>R-pakker har en standard struktur som må følges. For å bygge alle
nødvendig filer kan du kjøre:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usethis.r-lib.org" class="external-link">usethis</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">create_package</a></span><span class="op">(</span><span class="st">"~/path/to/minpakke"</span><span class="op">)</span></span></code></pre></div>
<p>Dette oppretter noen mapper og filer og vil ligne på dette <img src="images/pakke_struktur.png"></p>
<p>Hovedkomponenter er:</p>
<ul>
<li>
<code>R/</code> mappe hvor R-kode skal ligge.</li>
<li>
<code>man/</code> mappe hvor beskrivelsen av funksjoner skal
lagres.</li>
<li>En <code>DESCRIPTION</code> fil, som gi en generell beskrivelsen av
pakken.</li>
<li>En <code>NAMESPACE</code> fil, som forklarer hvordan pakken og
funksjoner skal kommunisere med andre pakker.</li>
<li>Når man lage en pakke, opprettes det en Rstudio prosjekt fil,
<code>pkgname.Rproj</code> og en <code>.buildignore</code> fil.</li>
</ul>
</div>
<div class="section level2">
<h2 id="description-fil">DESCRIPTION-fil<a class="anchor" aria-label="anchor" href="#description-fil"></a>
</h2>
<p><code>DESCRIPTION</code> filen sier noen generelt om pakken du lager.
Det inkluderer navn av pakken, beskrivelsen og hvem som har skrevet det.
Denne filen kan åpnes og redigeres direkte i RStudio. For eksempel:</p>
<p><img src="images/description.png"></p>
<p>Mer detaljer om DESCRIPTION filen finner du <a href="https://r-pkgs.org/description.html" class="external-link">her</a></p>
</div>
<div class="section level2">
<h2 id="dokumentasjon-av-kodefunksjoner">Dokumentasjon av kode/funksjoner<a class="anchor" aria-label="anchor" href="#dokumentasjon-av-kodefunksjoner"></a>
</h2>
<p>Funksjoner skal ligger som .R filer og skal flytte inn i mappen som
heter R/. Det er anbefalt å dokumentere funksjoner ved roxygen2. Da kan
du gi funksjoner et navn og beskrivelsen i tillegg til å spesifisere
parameter og det som returneres. Det er alltid god praksis å lage noen
enkel eksempler som viser hvordan funksjoner fungere. Mer om
dokumentasjon av koden ved roxygen2 finner du under <a href="https://r-pkgs.org/man.html" class="external-link">Object documentation</a>.</p>
</div>
<div class="section level2">
<h2 id="andre-filer">Andre filer<a class="anchor" aria-label="anchor" href="#andre-filer"></a>
</h2>
<p>Det er mye annet som kan inkludere i en pakke. For eksempel kan det
være nyttig til å inkludere noen små datasett til eksempler og testing.
Disse skal være syntetiske data eller offentlig datasett. Mer om å
inkludere data i pakken din finner du <a href="https://r-pkgs.org/data.html" class="external-link">her</a>.</p>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h2>
<p>Det er ikke strengt nødvendig å lage noen formelle tester
(enhetstester) til funksjoner i en pakke men det er anbefalt. Det kan
ofte bidra til færre bugs og bedre struktur i koden. Pakken <a href="https://testthat.r-lib.org" class="external-link">testthat</a> gi et rammeverk for å
lage og kjøre tester. En typisk test er å sjekke at en funksjon
returnere en forventet verdi. For eksempel kan vi bruke vectoren
<code>x</code> nede for å teste at funksjonen <code>mean</code>
returnerer den riktige verdien:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"The function mean returns a correct value"</span>,<span class="op">{</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Her bruker vi <code>expect_equal</code> og gir to verdier som vi
forventer er like. Mer hjelp og eksempler for tester ligger <a href="https://r-pkgs.org/tests.html#expectations" class="external-link">her</a>.</p>
<p>Koden for tester skal ligger i .R filer og skal ligge i pakken under
<a href="https://r-pkgs.org/tests.html#test-organisation" class="external-link">/tests/testthat/</a>.Filnavn
skal starte med <code>test</code>. I tillegg til fil(ene) som inneholder
tester skal det være en fil som heter <code>testthat.R</code>. Dette
lagres i mappen <code>/tests/</code> og gir instruks om det som skal
testes. For eksempel vil det vanligvis ligne på dette:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">minpakke</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link">test_check</a></span><span class="op">(</span><span class="st">"minpakke"</span><span class="op">)</span></span></code></pre></div>
<p>Mer informajson om testing finner du i <a href="https://r-pkgs.org/tests.html" class="external-link">kapittel 12</a>.</p>
</div>
<div class="section level2">
<h2 id="dele-med-andre-ved-git">Dele med andre ved git<a class="anchor" aria-label="anchor" href="#dele-med-andre-ved-git"></a>
</h2>
<p>Git er et verktøy for å versjonskontrollere kode og for å dele med
andre. Ved å legge pakken din på git betyr det at andre kan installere
pakken selv. Generelle informasjon om git i SSB finner du på <a href="https://ssbno.sharepoint.com/sites/Kompetanseogutvikling/SitePages/Git-i-SSB.aspx" class="external-link">Byrånettet</a>.
Mye informasjon om git og R finner i <a href="https://happygitwithr.com/index.html" class="external-link">Happy Git and Gihub for the
useR</a>.</p>
<p>Noen filer vil du inkludere på github/bitbucket men ikke i pakken din
når det bygges. Dette kan være, for eksempel, noen kjørekode som brukes
under utvikling/testing. En <a href="https://r-pkgs.org/package-structure-state.html?q=buildignore#rbuildignore" class="external-link">.Rbuildignore</a>-fil
kan inkluderes i git repo for å spesifisere hvilke filer ikke skal
bygges inn i pakken.</p>
</div>
<div class="section level2">
<h2 id="automatisere-testing-med-github-actions">Automatisere testing med github actions<a class="anchor" aria-label="anchor" href="#automatisere-testing-med-github-actions"></a>
</h2>
<p>Github Actions er en måte å automatisering testing av pakken din. Det
kjøres tester om pakken kan bygges og om alle enhetstester godkjennes
for hver gang none endringer blir pushe opp til github (for eksempel).
Det kan også teste funksjonene fine på forskjellige OS og på
forskjellige versjoner av R. Et eksempel av en pakke med tester og
github actions er klassR som ligger ut på github. Her kan du se litt på
workflows mappen og filene som kreves for å kjøre disse automatiserte
tester.</p>
<p>Mer informasjon om hvordan å sette opp github action for R finner på
<a href="https://orchid00.github.io/actions_sandbox/index.html#what-are-github-actions" class="external-link">Github
Actions with R</a> og/ eller på <a href="https://github.com/r-lib/actions" class="external-link">r-lib</a>.</p>
</div>
<div class="section level2">
<h2 id="sitte-fast">Sitte fast?<a class="anchor" aria-label="anchor" href="#sitte-fast"></a>
</h2>
<p>Hvis du sitter fast med et problem med pakke bygging er det veldig
sannsynlig at andre på SSB har hatt det samme problemet. Ta gjerne
kontakt med andre på <a href="https://www.yammer.com/ssb.no/#/threads/inGroup?type=in_group&amp;feedId=9481952" class="external-link">Yammer</a></p>
<p><img src="images/frustrated.png"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Susie Jentoft, Sindre Haugen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
